YUI.add("moodle-availability_password-popup",function(n,i){var t="#region-main",a=".availability_password-popup",s="#availability_password_input",r="#availability_password_error",l=".activity",c=".instancename",o=".activityicon";M.availability_password=M.availability_password||{},M.availability_password.popup={api:M.cfg.wwwroot+"/availability/condition/password/ajax.php",init:function(){var i=n.one(t);i&&(i.delegate("click",this.showPopup,a,this),i.delegate("click",this.checkShowPopup,l+" "+c,this),i.delegate("click",this.checkShowPopup,l+" "+o,this),this.initActivityLinks())},showPopup:function(i){var t,a,o,e;i.preventDefault(),i.stopPropagation(),a=i.currentTarget.get("href"),(o=(o=a.match(/id=(\d+)/))&&parseInt(o[1],10))&&(a="",(i=i.currentTarget.ancestor(l))&&(e=i.one(c))&&(a=e.getHTML()),i=(i=(i="")+'<div id="availability_password_intro">'+M.util.get_string("passwordintro","availability_password",a)+'</div><div class="form-group">')+'<label class="form-control-label" for="availability_password_input">'+M.util.get_string("enterpassword","availability_password")+'</label><input id="availability_password_input" class="form-control" type="password" /><div id="availability_password_error" class="invalid-feedback" style="display: none; "></div></div>',(t=new M.core.dialogue({headerContent:M.util.get_string("passwordprotection","availability_password",a),bodyContent:i,width:"350px",modal:!0}).show()).after("visibleChange",function(){t.get("visible")||t.destroy(!0)}),e=function(i){i.preventDefault(),0!==(i=n.one(s).get("value").trim()).length&&(i={sesskey:M.cfg.sesskey,id:o,password:i},n.io(this.api,{data:i,on:{success:function(i,t){var a;try{a=JSON.parse(t.responseText)}catch(o){return void window.alert("Communication error")}a.error?window.alert(a.error):a.success?a.redirect!==undefined?document.location=a.redirect:document.location.reload():(n.one(r).setHTML(M.util.get_string("wrongpassword","availability_password")),n.one(r).show(),n.one(s).addClass("is-invalid"),n.one(s).focus())}}}))},t.addButton({label:M.util.get_string("submit","core"),section:n.WidgetStdMod.FOOTER,action:e,context:this}),t.addButton({label:M.util.get_string("cancel","core"),section:n.WidgetStdMod.FOOTER,action:function(i){i.preventDefault(),t.hide()}}),n.one(s).focus().on("key",e,"enter",this))},checkShowPopup:function(i){var t=i.currentTarget;t.ancestor("a")||(t=t.ancestor(l).one(a))&&(i.preventDefault(),i.stopPropagation(),this.showPopup({currentTarget:t,preventDefault:function(){},stopPropagation:function(){}}))},initActivityLinks:function(){var i=l+" "+c+", "+l+" "+o;n.one(t).all(i).each(function(i){i.ancestor("a")||i.ancestor(l).one(a)&&i.setStyle("cursor","pointer")})}}},"@VERSION@",{requires:["base","node","event","moodle-core-notification-dialogue","io-base"]});