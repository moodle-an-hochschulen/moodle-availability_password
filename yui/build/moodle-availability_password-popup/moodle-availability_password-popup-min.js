YUI.add("moodle-availability_password-popup",function(s,i){var t="#region-main",a=".availability_password-popup",n="#availability_password_input",r="#availability_password_error",l=".activity",c=".instancename",e=".activityicon";M.availability_password=M.availability_password||{},M.availability_password.popup={api:M.cfg.wwwroot+"/availability/condition/password/ajax.php",init:function(){var i=s.one(t);i&&(i.delegate("click",this.showPopup,a,this),i.delegate("click",this.checkShowPopup,l+" "+c,this),i.delegate("click",this.checkShowPopup,l+" "+e,this),this.initActivityLinks())},showPopup:function(i){var t,a,e,o;i.preventDefault(),i.stopPropagation(),a=i.currentTarget.get("href"),(e=(e=a.match(/id=(\d+)/))&&parseInt(e[1],10))&&(a="",(i=i.currentTarget.ancestor(l))&&(o=i.one(c))&&(a=o.getHTML()),i=(i=(i="")+'<div id="availability_password_intro">'+M.util.get_string("passwordintro","availability_password",a)+"</div><div>")+'<label class="form-control-label" for="availability_password_input">'+M.util.get_string("enterpassword","availability_password")+'</label><input id="availability_password_input" class="form-control" type="password" /><div id="availability_password_error" class="invalid-feedback" style="display: none; "></div></div>',(t=new M.core.dialogue({headerContent:M.util.get_string("passwordprotection","availability_password",a),bodyContent:i,width:"350px",modal:!0,extraClasses:["availability_password_dialogue"]}).show()).after("visibleChange",function(){t.get("visible")||t.destroy(!0)}),o=function(i){i.preventDefault(),0!==(i=s.one(n).get("value").trim()).length&&(i={sesskey:M.cfg.sesskey,id:e,password:i},s.io(this.api,{data:i,on:{success:function(i,t){var a;try{a=JSON.parse(t.responseText)}catch(e){return void window.alert("Communication error")}a.error?window.alert(a.error):a.success?a.redirect!==undefined?document.location=a.redirect:document.location.reload():(s.one(r).setHTML(M.util.get_string("wrongpassword","availability_password")),s.one(r).show(),s.one(n).addClass("is-invalid"),s.one(n).focus())}}}))},t.addButton({label:M.util.get_string("submit","core"),section:s.WidgetStdMod.FOOTER,action:o,context:this,classNames:"btn btn-primary"}),t.addButton({label:M.util.get_string("cancel","core"),section:s.WidgetStdMod.FOOTER,action:function(i){i.preventDefault(),t.hide()},classNames:"btn btn-secondary"}),s.one(n).focus().on("key",o,"enter",this))},checkShowPopup:function(i){var t=i.currentTarget;t.ancestor("a")||(t=t.ancestor(l).one(a))&&(i.preventDefault(),i.stopPropagation(),this.showPopup({currentTarget:t,preventDefault:function(){},stopPropagation:function(){}}))},initActivityLinks:function(){var i=l+" "+c+", "+l+" "+e;s.one(t).all(i).each(function(i){i.ancestor("a")||i.ancestor(l).one(a)&&i.setStyle("cursor","pointer")})}}},"@VERSION@",{requires:["base","node","event","moodle-core-notification-dialogue","io-base"]});